# 网站搭建和部署指南

## 概述

本文档详细说明如何搭建 TimeArea 项目的开发环境，以及如何将项目部署到生产环境。包括多种部署平台的选择和配置方法。

## 目录

1. [本地开发环境搭建](#本地开发环境搭建)
2. [项目构建](#项目构建)
3. [部署平台选择](#部署平台选择)
4. [Vercel 部署](#vercel-部署)
5. [Netlify 部署](#netlify-部署)
6. [GitHub Pages 部署](#github-pages-部署)
7. [自建服务器部署](#自建服务器部署)
8. [域名配置](#域名配置)
9. [HTTPS 配置](#https-配置)
10. [CI/CD 自动化部署](#cicd-自动化部署)
11. [环境变量配置](#环境变量配置)
12. [常见问题](#常见问题)

---

## 本地开发环境搭建

### 1. 系统要求

- **Node.js**: >= 18.0.0
- **npm**: >= 9.0.0 或 **yarn**: >= 1.22.0 或 **pnpm**: >= 8.0.0
- **Git**: 用于版本控制

### 2. 安装 Node.js

#### Windows
1. 访问 https://nodejs.org/
2. 下载 LTS 版本安装包
3. 运行安装程序，按提示完成安装
4. 验证安装：
```bash
node --version
npm --version
```

#### macOS
```bash
# 使用 Homebrew
brew install node

# 或下载安装包
# 访问 https://nodejs.org/ 下载安装
```

#### Linux
```bash
# Ubuntu/Debian
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# CentOS/RHEL
curl -fsSL https://rpm.nodesource.com/setup_18.x | sudo bash -
sudo yum install -y nodejs
```

### 3. 克隆项目

```bash
# 如果项目在 GitHub
git clone https://github.com/your-username/TimeAreaWeb.git
cd TimeAreaWeb

# 或使用 SSH
git clone git@github.com:your-username/TimeAreaWeb.git
cd TimeAreaWeb
```

### 4. 安装依赖

```bash
# 使用 npm
npm install

# 或使用 yarn
yarn install

# 或使用 pnpm
pnpm install
```

### 5. 配置环境变量

创建 `.env` 文件：

```env
# 和风天气 API
VITE_WEATHER_API_KEY=your_qweather_api_key

# 百度地图 API
VITE_MAP_API_KEY=your_baidu_map_ak
```

### 6. 启动开发服务器

```bash
npm run dev
```

访问 http://localhost:5173

---

## 项目构建

### 1. 构建生产版本

```bash
npm run build
```

构建产物在 `dist` 目录。

### 2. 本地预览构建结果

```bash
npm run preview
```

访问 http://localhost:4173

### 3. 构建配置检查

构建前检查：
- [ ] 环境变量已正确配置
- [ ] API 密钥有效
- [ ] 代码无 TypeScript 错误
- [ ] 代码无 ESLint 错误

```bash
# 检查 TypeScript
npm run build

# 检查 ESLint
npm run lint
```

---

## 部署平台选择

### 平台对比

| 平台 | 免费额度 | 部署速度 | 配置难度 | 推荐度 |
|------|---------|---------|---------|--------|
| **Vercel** | 100GB/月带宽 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **Netlify** | 100GB/月带宽 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **GitHub Pages** | 1GB 存储 | ⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ |
| **Cloudflare Pages** | 无限带宽 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| **自建服务器** | 无限制 | ⭐⭐ | ⭐⭐ | ⭐⭐⭐ |

### 推荐方案

- **个人项目/小项目**: Vercel 或 Netlify（最简单）
- **开源项目**: GitHub Pages（免费且稳定）
- **企业项目**: 自建服务器或云服务商（完全控制）

---

## Vercel 部署

### 1. 准备工作

1. 注册 Vercel 账号：https://vercel.com
2. 将代码推送到 GitHub/GitLab/Bitbucket

### 2. 部署步骤

#### 方法1：通过 Web 界面部署

1. 登录 Vercel
2. 点击 "Add New Project"
3. 导入 Git 仓库
4. 配置项目：
   - **Framework Preset**: Vite
   - **Build Command**: `npm run build`
   - **Output Directory**: `dist`
   - **Install Command**: `npm install`
5. 添加环境变量：
   - `VITE_WEATHER_API_KEY`
   - `VITE_MAP_API_KEY`
6. 点击 "Deploy"

#### 方法2：使用 Vercel CLI

```bash
# 安装 Vercel CLI
npm i -g vercel

# 登录
vercel login

# 部署
vercel

# 生产环境部署
vercel --prod
```

### 3. 配置自定义域名

1. 在 Vercel 项目设置中点击 "Domains"
2. 添加域名
3. 按照提示配置 DNS：
   - 添加 CNAME 记录指向 `cname.vercel-dns.com`
   - 或添加 A 记录指向 Vercel IP

### 4. 环境变量配置

在 Vercel 项目设置中：
1. 进入 "Settings" -> "Environment Variables"
2. 添加环境变量：
   - `VITE_WEATHER_API_KEY` (Production, Preview, Development)
   - `VITE_MAP_API_KEY` (Production, Preview, Development)

### 5. 自动部署

Vercel 会自动：
- 监听 Git 推送
- 自动构建和部署
- 为每个 PR 创建预览环境

---

## Netlify 部署

### 1. 准备工作

1. 注册 Netlify 账号：https://www.netlify.com
2. 将代码推送到 Git 仓库

### 2. 部署步骤

#### 方法1：通过 Web 界面部署

1. 登录 Netlify
2. 点击 "Add new site" -> "Import an existing project"
3. 连接 Git 仓库
4. 配置构建设置：
   - **Build command**: `npm run build`
   - **Publish directory**: `dist`
   - **Base directory**: (留空)
5. 添加环境变量（在 "Site settings" -> "Environment variables"）
6. 点击 "Deploy site"

#### 方法2：使用 Netlify CLI

```bash
# 安装 Netlify CLI
npm install -g netlify-cli

# 登录
netlify login

# 初始化
netlify init

# 部署
netlify deploy --prod
```

### 3. 创建 netlify.toml 配置文件

在项目根目录创建 `netlify.toml`：

```toml
[build]
  command = "npm run build"
  publish = "dist"

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

[build.environment]
  NODE_VERSION = "18"
```

### 4. 配置自定义域名

1. 在 Netlify 项目设置中点击 "Domain settings"
2. 添加自定义域名
3. 配置 DNS：
   - 添加 CNAME 记录指向 `your-site.netlify.app`
   - 或添加 A 记录指向 Netlify IP

---

## GitHub Pages 部署

### 1. 准备工作

1. 确保项目在 GitHub 上
2. 项目设置为 Public（或使用 GitHub Pro）

### 2. 配置 GitHub Actions

创建 `.github/workflows/deploy.yml`：

```yaml
name: Deploy to GitHub Pages

on:
  push:
    branches:
      - main
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build
        run: npm run build
        env:
          VITE_WEATHER_API_KEY: ${{ secrets.VITE_WEATHER_API_KEY }}
          VITE_MAP_API_KEY: ${{ secrets.VITE_MAP_API_KEY }}

      - name: Setup Pages
        uses: actions/configure-pages@v4

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: './dist'

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
```

### 3. 配置 GitHub Pages

1. 进入仓库 Settings -> Pages
2. Source 选择 "GitHub Actions"
3. 保存设置

### 4. 配置环境变量（GitHub Secrets）

GitHub Actions 需要使用 Secrets 来存储敏感信息（如 API 密钥）。配置步骤如下：

#### 步骤 1：进入仓库设置

1. 打开你的 GitHub 仓库页面
2. 点击仓库顶部的 **"Settings"**（设置）标签
3. 在左侧菜单中找到 **"Secrets and variables"**（密钥和变量）
4. 点击展开，选择 **"Actions"**

#### 步骤 2：添加新的 Secret

1. 点击 **"New repository secret"**（新建仓库密钥）按钮
2. 填写 Secret 信息：
   - **Name（名称）**: `VITE_WEATHER_API_KEY`
   - **Secret（值）**: 粘贴你的和风天气 API Key
3. 点击 **"Add secret"**（添加密钥）

#### 步骤 3：添加第二个 Secret

重复步骤 2，添加第二个 Secret：
- **Name（名称）**: `VITE_MAP_API_KEY`
- **Secret（值）**: 粘贴你的百度地图 API Key

#### 配置完成后的效果

配置完成后，你应该看到两个 Secrets：
- ✅ `VITE_WEATHER_API_KEY`
- ✅ `VITE_MAP_API_KEY`

#### 注意事项

⚠️ **重要提示**：
- Secrets 的值一旦保存后**无法再次查看**，只能重新设置
- Secrets 只在 GitHub Actions 工作流中可用
- 不要在代码中直接使用 Secrets，它们会自动注入到构建环境
- 如果 Secret 值有误，可以点击 Secret 名称，然后点击 **"Update"** 更新

#### 验证配置

配置完成后，当你推送代码触发 GitHub Actions 时：
1. 进入仓库的 **"Actions"** 标签
2. 查看工作流运行日志
3. 在构建步骤中，环境变量会被自动注入
4. 如果构建成功，说明 Secrets 配置正确

#### 获取 API 密钥

如果还没有 API 密钥，请参考：

**和风天气 API**：
1. 访问 https://dev.qweather.com/
2. 注册/登录账号
3. 创建应用，获取 Key

**百度地图 API**：
1. 访问 https://lbsyun.baidu.com/
2. 注册/登录账号
3. 创建应用，获取 AK（Access Key）

### 5. 更新 vite.config.ts（重要！）

GitHub Pages 有两种部署方式，需要不同的配置：

#### 情况 1：项目页面（推荐）

如果你的 GitHub Pages URL 是：`https://你的用户名.github.io/仓库名/`

**需要添加 `base` 配置**：

1. 打开 `vite.config.ts` 文件
2. 在 `defineConfig` 中添加 `base` 属性：

```typescript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import { VitePWA } from 'vite-plugin-pwa'

export default defineConfig({
  base: '/TimeAreaWeb/', // ⚠️ 改为你的仓库名称，末尾必须有斜杠
  plugins: [
    react(),
    VitePWA({
      // ... 现有配置
    })
  ],
  server: {
    // ... 现有配置
  }
})
```

**重要**：
- `base` 的值必须是 `/仓库名/`（前后都有斜杠）
- 例如：如果仓库名是 `TimeAreaWeb`，则 `base: '/TimeAreaWeb/'`
- 如果仓库名是 `my-weather-app`，则 `base: '/my-weather-app/'`

#### 情况 2：用户/组织页面

如果你的 GitHub Pages URL 是：`https://你的用户名.github.io/`（没有仓库名）

**不需要配置 `base`**，或者设置为 `base: '/'`

#### 如何判断使用哪种方式？

1. 进入仓库 Settings -> Pages
2. 查看 "Source" 部分：
   - 如果选择的是 `main` 分支的 `/docs` 文件夹 → 项目页面（需要 base）
   - 如果选择的是 `main` 分支的 `/ (root)` → 项目页面（需要 base）
   - 如果选择的是 `gh-pages` 分支 → 项目页面（需要 base）

**注意**：GitHub Actions 部署方式默认是项目页面，所以**通常需要配置 base**。

#### 配置示例

假设你的仓库名是 `TimeAreaWeb`：

```typescript
export default defineConfig({
  base: '/TimeAreaWeb/', // ✅ 正确：前后都有斜杠
  // base: '/TimeAreaWeb',  // ❌ 错误：末尾缺少斜杠
  // base: 'TimeAreaWeb/',   // ❌ 错误：开头缺少斜杠
  plugins: [
    // ... 现有配置
  ]
})
```

#### 配置后验证

配置完成后：
1. 本地构建测试：`npm run build`
2. 检查 `dist/index.html` 中的资源路径是否正确
3. 本地预览：`npm run preview`，访问 `http://localhost:4173/TimeAreaWeb/` 测试

#### 常见问题

**Q: 如果忘记配置 base 会怎样？**
A: 部署后资源文件（JS、CSS）会加载失败，页面显示空白或样式错乱。

**Q: base 配置错误会怎样？**
A: 同样会导致资源加载失败。确保格式是 `/仓库名/`。

**Q: 使用自定义域名还需要 base 吗？**
A: 如果使用自定义域名（如 `https://timearea.com`），可以设置 `base: '/'`。

### 6. 触发部署

推送代码到 main 分支，GitHub Actions 会自动部署。

### 7. 搜索引擎可见性优化

GitHub Pages 部署的网站**可以被搜索引擎正常索引**，但需要做一些优化：

#### ✅ 已实现的 SEO 功能

项目已经集成了完整的 SEO 优化：
- ✅ 动态 Meta 标签（标题、描述、关键词）
- ✅ Open Graph 标签（社交媒体分享）
- ✅ 结构化数据（JSON-LD）
- ✅ robots.txt 和 sitemap.xml

#### 📝 部署后需要做的优化

1. **更新 sitemap.xml 域名**
   
   部署后，更新 `public/sitemap.xml` 中的域名：
   ```xml
   <loc>https://你的用户名.github.io/项目名/</loc>
   ```

2. **更新 robots.txt**
   
   更新 `public/robots.txt` 中的 sitemap 地址：
   ```
   Sitemap: https://你的用户名.github.io/项目名/sitemap.xml
   ```

3. **提交到搜索引擎**
   
   - **Google Search Console**:
     
     **步骤 1: 访问并添加属性**
     1. 访问 https://search.google.com/search-console
     2. 点击左侧"属性"下拉菜单，选择"添加属性"
     3. 选择"网址前缀"方式，输入：`https://fengchenteamo.github.io/TimeAreaWeb/`
     4. 点击"继续"
     
     **步骤 2: 验证所有权**
     1. 选择"HTML 标签"验证方式
     2. 复制验证代码（类似：`<meta name="google-site-verification" content="xxxxx" />`）
     3. 将验证代码添加到 `index.html` 的 `<head>` 标签中
     4. 保存并提交代码到 GitHub（触发部署）
     5. 等待部署完成后，回到 Google Search Console 点击"验证"
     
     **步骤 3: 提交 sitemap.xml** ⭐
     1. 验证成功后，在左侧菜单中找到"索引" → "Sitemaps"
     2. 在"添加新的 sitemap"输入框中，输入：`sitemap.xml`
     > 💡 **注意**: 只需要输入 `sitemap.xml`，不需要完整 URL，因为 Google 会自动使用你已验证的网站域名
     3. 点击"提交"
     4. 等待几分钟后，状态会显示为"成功"或"已发现 X 个网址"
     
     **步骤 4: 检查提交状态**
     - 提交后，Google 会显示 sitemap 的状态：
       - ✅ **成功**: sitemap 已处理，网址已发现
       - ⚠️ **部分成功**: 部分网址有问题，查看详情
       - ❌ **无法获取**: 检查 sitemap.xml 路径是否正确
     - 通常几分钟内就能看到结果
     - 如果显示错误，检查 `public/sitemap.xml` 文件是否存在且格式正确
     
     **步骤 5: 排查"无法读取此站点地图"错误** 🔧
     
     如果 Google Search Console 显示"无法读取此站点地图"，按以下步骤排查：
     
     1. **验证 sitemap.xml 是否可访问**
        - 在浏览器中访问：`https://fengchenteamo.github.io/TimeAreaWeb/sitemap.xml`
        - 应该能看到 XML 内容，而不是 404 错误
        - 如果显示 404，说明文件未正确部署
     
     2. **检查文件位置**
        - 确保 `sitemap.xml` 在 `public/` 目录下
        - 确保文件已提交到 GitHub 并已部署
     
     3. **检查域名大小写**
        - GitHub Pages URL 中的用户名应该是**小写**
        - 确保 sitemap.xml 中的 URL 使用小写：`fengchenteamo`（不是 `FengChenTeAmo`）
        - 检查 `public/sitemap.xml` 和 `public/robots.txt` 中的域名
     
     4. **检查 XML 格式**
        - 确保 XML 格式正确，没有语法错误
        - 可以使用在线 XML 验证工具检查：https://www.xmlvalidation.com/
     
     5. **检查文件编码**
        - 确保文件使用 UTF-8 编码
        - 确保 XML 声明正确：`<?xml version="1.0" encoding="UTF-8"?>`
     
     6. **等待部署完成**
        - 如果刚提交代码，等待 GitHub Actions 部署完成（通常 2-5 分钟）
        - 部署完成后再次尝试提交 sitemap
     
     7. **使用完整 URL 提交**
        - 如果输入 `sitemap.xml` 不行，可以尝试输入完整 URL：
          `https://fengchenteamo.github.io/TimeAreaWeb/sitemap.xml`
     
     8. **检查 robots.txt**
        - 确保 `robots.txt` 允许访问 sitemap.xml
        - 检查 `public/robots.txt` 中是否有 `Disallow: /sitemap.xml`（如果有，删除它）
     
     **常见错误和解决方案**：
     
     | 错误信息 | 可能原因 | 解决方案 |
     |---------|---------|---------|
     | 无法获取 | sitemap.xml 返回 404 | 检查文件是否在 `public/` 目录，是否已部署 |
     | 无法获取 | 域名大小写错误 | 将 URL 中的用户名改为小写 |
     | 无法获取 | XML 格式错误 | 使用 XML 验证工具检查格式 |
     | 无法获取 | 文件编码错误 | 确保使用 UTF-8 编码 |
     | 无法获取 | 部署未完成 | 等待 GitHub Actions 部署完成 |
   
   - **百度站长平台**（可选）:
     > ⚠️ **注意**: 百度站长平台对免费账户有站点数量限制（通常为 3-5 个站点）。如果遇到"该主域可添加站点数量超过限制"的提示，可以：
     > - 删除一些不常用的旧站点
     > - 或者跳过百度站长平台提交（网站仍会被百度自然收录，只是时间可能稍长）
     > 
     > 即使不提交到百度站长平台，只要网站有正确的 SEO 配置（robots.txt、sitemap.xml），百度仍然会通过以下方式发现和收录：
     > - 通过其他网站的外链
     > - 通过 GitHub 的链接
     > - 通过 sitemap.xml（如果被其他搜索引擎发现）
     > - 通过用户搜索和访问
     
     如果账户未达到限制，可以按以下步骤提交：
     1. 访问 https://ziyuan.baidu.com/
     2. 添加网站
     3. 验证网站（使用 HTML 标签）
     4. 提交 sitemap

4. **验证 SEO 配置**
   
   使用以下工具验证：
   - [Google 结构化数据测试](https://search.google.com/test/rich-results)
   - [Google Mobile-Friendly Test](https://search.google.com/test/mobile-friendly)
   - [PageSpeed Insights](https://pagespeed.web.dev/)

#### 🚀 提升搜索引擎可见性的建议

1. **内容优化**
   - 确保页面有实际内容（不只是动态加载）
   - 使用语义化 HTML 标签
   - 添加图片 alt 属性

2. **链接建设**
   - 在 GitHub README 中添加网站链接
   - 在社交媒体分享网站
   - 获取其他网站的外链

3. **定期更新**
   - 定期更新内容
   - 保持网站活跃度
   - 更新 sitemap 的 lastmod 日期

4. **性能优化**
   - 优化页面加载速度
   - 使用 CDN 加速
   - 压缩图片和资源

#### ⚠️ 注意事项

- **GitHub Pages 默认支持 HTTPS**，有利于 SEO
- **GitHub Pages 的域名**（github.io）在搜索引擎中权重较高
- **自定义域名**可以提升品牌识别度
- **SPA 路由**需要正确配置，确保搜索引擎能抓取所有页面

#### 📊 搜索引擎收录时间

- **Google**: 通常 1-7 天（提交 sitemap 后更快）
- **百度**: 
  - 提交到站长平台：通常 1-2 周
  - 未提交到站长平台：通常 2-4 周（通过自然爬取）
- **Bing**: 通常 3-7 天

#### 💡 百度站长平台限制的替代方案

如果无法提交到百度站长平台（站点数量限制），可以通过以下方式提升百度收录：

1. **确保 SEO 配置正确**
   - ✅ robots.txt 已配置（允许爬取）
   - ✅ sitemap.xml 已配置（路径正确）
   - ✅ Meta 标签完整
   - ✅ 结构化数据正确

2. **通过外链提升发现率**
   - 在 GitHub README 中添加网站链接
   - 在社交媒体（微博、知乎等）分享网站
   - 在技术博客或论坛中提及网站
   - 在其他网站添加友情链接

3. **使用百度主动推送 API**（需要验证）
   - 如果之前已添加过其他站点，可以使用 API 主动推送
   - 参考：https://ziyuan.baidu.com/college/courseinfo?id=267&page=2#h2_article_title14

4. **等待自然收录**
   - 百度会通过爬取 GitHub 和其他网站发现你的网站
   - 只要 SEO 配置正确，通常 2-4 周内会被收录

#### ✅ 重要提示

**即使不提交到百度站长平台，网站仍然可以被搜索引擎发现和收录！**

- 你的网站已经配置了完整的 SEO（robots.txt、sitemap.xml、Meta 标签）
- GitHub Pages 的 `github.io` 域名在搜索引擎中权重较高
- 只要网站有外链和访问，搜索引擎会自动发现

**建议优先级**：
1. ✅ **必须做**: 提交到 Google Search Console（无限制，免费）
2. ⭐ **推荐做**: 在 GitHub README 中添加网站链接
3. 💡 **可选做**: 如果百度账户未满，提交到百度站长平台

---

## 自建服务器部署

### 1. 服务器要求

- **操作系统**: Ubuntu 20.04+ / CentOS 7+
- **内存**: 至少 1GB
- **存储**: 至少 10GB
- **网络**: 公网 IP

### 2. 安装 Nginx

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install nginx

# CentOS/RHEL
sudo yum install nginx
```

### 3. 构建项目

在本地或服务器上：

```bash
# 克隆项目
git clone https://github.com/your-username/TimeAreaWeb.git
cd TimeAreaWeb

# 安装依赖
npm install

# 构建
npm run build
```

### 4. 配置 Nginx

创建配置文件 `/etc/nginx/sites-available/timearea`：

```nginx
server {
    listen 80;
    server_name your-domain.com www.your-domain.com;
    
    root /var/www/timearea/dist;
    index index.html;

    # Gzip 压缩
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml+rss application/json;

    # SPA 路由支持
    location / {
        try_files $uri $uri/ /index.html;
    }

    # 静态资源缓存
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # 安全头
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
}
```

启用配置：

```bash
sudo ln -s /etc/nginx/sites-available/timearea /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

### 5. 部署文件

```bash
# 创建目录
sudo mkdir -p /var/www/timearea

# 复制构建文件
sudo cp -r dist/* /var/www/timearea/

# 设置权限
sudo chown -R www-data:www-data /var/www/timearea
sudo chmod -R 755 /var/www/timearea
```

### 6. 使用 PM2 管理（可选）

如果需要 Node.js 服务：

```bash
# 安装 PM2
npm install -g pm2

# 启动应用
pm2 start npm --name "timearea" -- start

# 设置开机自启
pm2 startup
pm2 save
```

---

## 域名配置

### 1. 购买域名

推荐域名注册商：
- **国内**: 阿里云、腾讯云、华为云
- **国外**: Namecheap、GoDaddy、Cloudflare

### 2. DNS 配置

#### Vercel/Netlify

添加 CNAME 记录：
```
类型: CNAME
名称: @ 或 www
值: cname.vercel-dns.com (Vercel)
     或 your-site.netlify.app (Netlify)
TTL: 3600
```

#### 自建服务器

添加 A 记录：
```
类型: A
名称: @
值: 服务器 IP 地址
TTL: 3600
```

### 3. 等待 DNS 生效

DNS 生效通常需要 10 分钟到 48 小时。

检查 DNS 是否生效：
```bash
# Windows
nslookup your-domain.com

# Linux/macOS
dig your-domain.com
```

---

## HTTPS 配置

### 1. Vercel/Netlify

自动提供 HTTPS，无需配置。

### 2. 自建服务器 - 使用 Let's Encrypt

```bash
# 安装 Certbot
sudo apt install certbot python3-certbot-nginx

# 获取证书
sudo certbot --nginx -d your-domain.com -d www.your-domain.com

# 自动续期（已自动配置）
sudo certbot renew --dry-run
```

更新 Nginx 配置：

```nginx
server {
    listen 443 ssl http2;
    server_name your-domain.com www.your-domain.com;
    
    ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;
    
    # SSL 优化
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;
    
    # ... 其他配置
}

# HTTP 重定向到 HTTPS
server {
    listen 80;
    server_name your-domain.com www.your-domain.com;
    return 301 https://$server_name$request_uri;
}
```

---

## CI/CD 自动化部署

### 1. GitHub Actions（已配置）

参考 [GitHub Pages 部署](#github-pages-部署) 部分。

### 2. GitLab CI

创建 `.gitlab-ci.yml`：

```yaml
image: node:18

stages:
  - build
  - deploy

cache:
  paths:
    - node_modules/

build:
  stage: build
  script:
    - npm ci
    - npm run build
  artifacts:
    paths:
      - dist/
    expire_in: 1 hour
  only:
    - main

deploy:
  stage: deploy
  script:
    - echo "Deploy to server"
    # 添加部署脚本
  only:
    - main
```

### 3. 自动部署脚本

创建 `deploy.sh`：

```bash
#!/bin/bash

# 拉取最新代码
git pull origin main

# 安装依赖
npm install

# 构建
npm run build

# 部署到服务器
rsync -avz --delete dist/ user@server:/var/www/timearea/

# 重启服务（如需要）
ssh user@server "sudo systemctl reload nginx"
```

---

## 环境变量配置

### 1. 开发环境

创建 `.env`：
```env
VITE_WEATHER_API_KEY=your_key
VITE_MAP_API_KEY=your_key
```

### 2. 生产环境

#### Vercel
- Settings -> Environment Variables

#### Netlify
- Site settings -> Environment variables

#### GitHub Actions
- Repository Settings -> Secrets and variables -> Actions

#### 自建服务器
创建 `.env.production`：
```env
VITE_WEATHER_API_KEY=your_production_key
VITE_MAP_API_KEY=your_production_key
```

### 3. 环境变量安全

⚠️ **重要提示**：
- 不要将 `.env` 文件提交到 Git
- 使用不同环境的不同 API 密钥
- 定期轮换 API 密钥
- 使用密钥管理服务（如 AWS Secrets Manager）

---

## 常见问题

### Q1: 构建失败

**问题**: `npm run build` 报错

**解决方案**:
1. 检查 Node.js 版本：`node --version`（需要 >= 18）
2. 清除缓存：`rm -rf node_modules package-lock.json && npm install`
3. 检查 TypeScript 错误：`npm run lint`
4. 检查环境变量是否配置

### Q2: 部署后页面空白

**问题**: 部署后访问显示空白页面

**解决方案**:
1. 检查浏览器控制台错误
2. 确认 `base` 路径配置正确（GitHub Pages 需要配置）
3. 检查路由配置（SPA 需要服务器重定向）
4. 检查 API 密钥是否正确

### Q3: API 调用失败

**问题**: 天气或地图 API 无法调用

**解决方案**:
1. 检查环境变量是否在部署平台正确配置
2. 检查 API 密钥是否有效
3. 检查 API 调用频率限制
4. 检查域名白名单配置（百度地图需要）

### Q4: 路由 404 错误

**问题**: 直接访问路由返回 404

**解决方案**:
1. 配置服务器重定向（Nginx 配置 `try_files`）
2. Vercel/Netlify 会自动处理
3. GitHub Pages 需要配置 `base` 路径

### Q5: 构建产物过大

**问题**: 构建后的文件太大

**解决方案**:
1. 启用代码分割
2. 使用 CDN 加载第三方库
3. 压缩图片资源
4. 启用 Gzip/Brotli 压缩

### Q6: HTTPS 证书问题

**问题**: 自建服务器 HTTPS 证书错误

**解决方案**:
1. 检查证书是否过期：`sudo certbot certificates`
2. 更新证书：`sudo certbot renew`
3. 检查 Nginx 配置中的证书路径
4. 确保防火墙开放 443 端口

### Q7: 部署后样式丢失

**问题**: 部署后 CSS 样式不生效

**解决方案**:
1. 检查构建路径配置
2. 检查静态资源路径
3. 清除浏览器缓存
4. 检查 CDN 配置（如使用）

---

## 性能优化

### 1. 构建优化

```typescript
// vite.config.ts
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          'react-vendor': ['react', 'react-dom'],
          'antd-vendor': ['antd'],
        },
      },
    },
    chunkSizeWarningLimit: 1000,
  },
})
```

### 2. 静态资源优化

- 使用 WebP 格式图片
- 压缩图片大小
- 使用 CDN 加速

### 3. 缓存策略

- 静态资源长期缓存
- API 响应合理缓存
- Service Worker 缓存（PWA）

---

## 监控和维护

### 1. 监控工具

- **Vercel Analytics**: 内置分析
- **Google Analytics**: 用户行为分析
- **Sentry**: 错误监控
- **Uptime Robot**: 可用性监控

### 2. 日志查看

#### Vercel
- Dashboard -> Logs

#### Netlify
- Site overview -> Deploys -> View logs

#### 自建服务器
```bash
# Nginx 日志
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log
```

### 3. 定期维护

- [ ] 定期更新依赖：`npm update`
- [ ] 检查安全漏洞：`npm audit`
- [ ] 备份数据（如需要）
- [ ] 监控 API 使用量
- [ ] 检查服务器资源使用

---

## 总结

### 快速部署检查清单

- [ ] 代码推送到 Git 仓库
- [ ] 环境变量配置完成
- [ ] 选择部署平台
- [ ] 配置域名（如需要）
- [ ] 配置 HTTPS（如需要）
- [ ] 测试部署结果
- [ ] 配置监控和告警
- [ ] 文档更新

### 推荐部署流程

1. **开发阶段**: 本地开发，使用 `npm run dev`
2. **测试阶段**: 部署到 Vercel/Netlify 预览环境
3. **生产阶段**: 部署到生产环境，配置自定义域名
4. **维护阶段**: 监控、更新、优化

### 获取帮助

- **Vercel 文档**: https://vercel.com/docs
- **Netlify 文档**: https://docs.netlify.com
- **GitHub Pages 文档**: https://docs.github.com/pages
- **Nginx 文档**: https://nginx.org/en/docs/

---

**祝部署顺利！** 🚀
